/******************************************************************************
*                      Includes
******************************************************************************/
#include "AFS_pwm.h"

/******************************************************************************
*                      Defines and data types
******************************************************************************/

/******************************************************************************
*                      Global variables
******************************************************************************/

/******************************************************************************
*                      Static variables
******************************************************************************/
/******************************************************************************
*                      Internal function prototypes
******************************************************************************/


/******************************************************************************
*                      Public functions
******************************************************************************/
void AFS_pwm_init()
{
// Timer 0 configuration
    TCCR0A|=((1<<WGM01)|(1<<WGM00));
    TCCR0B|=((1<<CS02)|(1<<CS00));
    TCCR0B&=~(1<<CS01);
    TCNT0=0x00;

    TCCR0A|=(1<<COM0A1);
    TCCR0A&=~(1<<COM0A0);

    TCCR0A|=(1<<COM0B1);
    TCCR0A&=~(1<<COM0B0);


// timer 1 configuration

TCCR1A|=(1<<WGM10);
TCCR1A&=~(1<<WGM11);
TCCR1B|=(1<<WGM12);
TCCR1B&=~(1<<WGM13);
TCCR1B|=((1<<CS12)|(1<<CS10));
TCCR1B&=~(1<<CS11);
TCNT1H=0x00;
TCNT1L=0x00;


TCCR1A|=(1<<COM1A1);
TCCR1A&=~(1<<COM1A0);

TCCR1A|=(1<<COM1B1);
TCCR1A&=~(1<<COM1B0);


//timer 2 configuration
TCCR2A|=((1<<WGM21)|(1<<WGM20));
TCCR2B|=((1<<CS22)|(1<<CS20)|(1<<CS21));


TCCR2A|=(1<<COM2A1);
TCCR2A&=~(1<<COM2A0);



TCCR2B|=(1<<COM2B1);
TCCR2B&=~(1<<COM2B0);
}


void AFS_pwm_set(uint8_t pin, uint8_t dutycycle)
{


//OCR0B=dutycycle*255*0.01;


    switch(pin)
    {
    case PD6:
        DDRD|=(1<<PD6);
        OCR0A=dutycycle*254*0.01;

        break;
    case PD5:

        OCR0B=dutycycle*254*0.01;
        break;

    case PB1:
        DDRB|=(1<<PB1);
        OCR1A=dutycycle*254*0.01;
        break;
    case PB2:
        DDRB|=(1<<PB2);
        OCR1B=dutycycle*254*0.01;
        break;
     case PB3:
         DDRB|=(1<<PB3);
        OCR2A=dutycycle*254*0.01;
        break;


}

}
